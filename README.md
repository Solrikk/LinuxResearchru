
# Справочник по основам Linux

## 1. Как посмотреть версию ядра Linux?

### Основные команды:
```bash
uname -r   # только версия ядра
uname -a   # полная информация о системе
```

**Пример вывода `uname -r`:**
```
5.4.0-135-generic
```

**Пример вывода `uname -a`:**
```
Linux hostname 5.4.0-135-generic #152-Ubuntu SMP Wed Nov 23 20:19:22 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
```

### Дополнительные способы:
```bash
cat /proc/version   # информация о ядре и компиляторе
hostnamectl         # системная информация (для systemd)
cat /proc/sys/kernel/osrelease  # только релиз ядра
```

---

## 2. Как узнать дистрибутив и его версию?

### Универсальный способ (работает везде):
```bash
cat /etc/os-release
```

**Пример вывода:**
```
NAME="Ubuntu"
VERSION="22.04.3 LTS (Jammy Jellyfish)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 22.04.3 LTS"
VERSION_ID="22.04"
```

### Для Debian/Ubuntu:
```bash
lsb_release -a
```

**Пример вывода:**
```
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.3 LTS
Release:        22.04
Codename:       jammy
```

### Для Red Hat/CentOS/Fedora:
```bash
cat /etc/redhat-release   # CentOS/RHEL
cat /etc/fedora-release   # Fedora
cat /etc/centos-release   # CentOS
```

### Альтернативные способы:
```bash
cat /etc/issue          # краткая информация
cat /etc/issue.net      # для сетевых подключений
hostnamectl             # для systemd систем
```

---

## 3. Как посмотреть список запущенных процессов?

### 1. Команда `ps`

**Основные варианты:**
```bash
ps aux          # все процессы всех пользователей
ps -ef          # альтернативный формат
ps -elf         # расширенная информация
ps -u username  # процессы конкретного пользователя
```

**Объяснение колонок `ps aux`:**
- **USER** — владелец процесса
- **PID** — идентификатор процесса
- **%CPU** — использование процессора
- **%MEM** — использование памяти
- **VSZ** — виртуальная память (КБ)
- **RSS** — физическая память (КБ)
- **TTY** — терминал
- **STAT** — состояние процесса
- **START** — время запуска
- **TIME** — время CPU
- **COMMAND** — команда

**Полезные примеры:**
```bash
ps aux | grep nginx     # найти процессы nginx
ps aux | head -20       # первые 20 процессов
ps aux --sort=-%cpu     # сортировка по CPU
ps aux --sort=-%mem     # сортировка по памяти
```

### 2. Интерактивные команды

**`top` — базовый мониторинг:**
```bash
top
```
*Управление:* `q` (выход), `P` (сортировка по CPU), `M` (по памяти), `k` (убить процесс)

**`htop` — улучшенная версия:**
```bash
htop
```
*Установка:* `sudo apt install htop` или `sudo yum install htop`

### 3. Древовидное отображение
```bash
pstree          # дерево процессов
pstree -p       # с PID
pstree username # процессы пользователя
```

### 4. Подробная информация
```bash
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem  # кастомные колонки
ps -aux --forest                           # древовидный вывод
```

---

## 4. Как завершить процесс?

### Сигналы в Linux

| Сигнал | Номер | Описание |
|--------|-------|----------|
| SIGTERM | 15 | Мягкое завершение (по умолчанию) |
| SIGKILL | 9 | Принудительное завершение |
| SIGINT | 2 | Прерывание (Ctrl+C) |
| SIGHUP | 1 | Перезагрузка конфигурации |
| SIGSTOP | 19 | Приостановка процесса |

### Методы завершения:

#### 1. В текущем терминале:
```bash
Ctrl+C    # прерывание (SIGINT)
Ctrl+Z    # приостановка (SIGTSTP)
Ctrl+\    # принудительное завершение (SIGQUIT)
```

#### 2. По PID:
```bash
kill PID              # мягкое завершение (SIGTERM)
kill -15 PID          # то же самое явно
kill -9 PID           # принудительное (SIGKILL)
kill -TERM PID        # мягкое завершение по имени
kill -KILL PID        # принудительное по имени
```

#### 3. По имени процесса:
```bash
pkill nginx           # завершить все процессы nginx
pkill -9 nginx        # принудительно
pkill -u username     # все процессы пользователя
killall nginx         # аналог pkill
```

#### 4. Интерактивное завершение:
```bash
top                   # нажать 'k', ввести PID
htop                  # выбрать процесс, нажать F9
```

### Проверка завершения:
```bash
ps aux | grep процесс
kill -0 PID          # проверить, существует ли процесс
```

---

## 5. Поиск файлов

### Команда `find` — основной инструмент

#### Базовый синтаксис:
```bash
find /путь -опции критерии
```

#### Поиск по имени:
```bash
find /home -name "*.txt"           # все .txt файлы
find /var -name "access.log"       # конкретный файл
find . -name "*.py"                # Python файлы в текущей папке
find /etc -iname "*.CONF"          # без учета регистра
```

#### Поиск по типу:
```bash
find /home -type f              # только файлы
find /home -type d              # только директории
find /home -type l              # только символические ссылки
```

#### Поиск по размеру:
```bash
find /var -size +100M           # больше 100 МБ
find /home -size -1k            # меньше 1 КБ
find /tmp -size 50M             # точно 50 МБ
find /var -size +1G -type f     # файлы больше 1 ГБ
```

#### Поиск по времени:
```bash
find /var -mtime -7             # изменены за последние 7 дней
find /tmp -atime +30            # не открывались более 30 дней
find /home -ctime -1            # метаданные изменены за сутки
find /var -newer file.txt       # новее чем file.txt
```

#### Поиск по правам доступа:
```bash
find /home -perm 644            # точно права 644
find /var -perm -644            # минимум права 644
find /usr -perm /u+w            # владелец может писать
find / -perm 4755               # SUID биты
```

#### Действия с найденными файлами:
```bash
find /tmp -name "*.tmp" -delete                    # удалить
find /home -name "*.log" -exec rm {} \;            # удалить через exec
find /var -type f -exec ls -lh {} \;               # показать детали
find /home -name "*.txt" -exec grep "error" {} \;  # поиск в файлах
```

### Альтернативные команды:

#### `locate` — быстрый поиск:
```bash
locate filename         # поиск в базе данных
sudo updatedb          # обновить базу данных
locate -i filename     # без учета регистра
```

#### `which` — поиск исполняемых файлов:
```bash
which python           # где находится python
which -a python        # все вхождения в PATH
```

#### `whereis` — поиск бинарников, исходников, man страниц:
```bash
whereis python         # исполняемые файлы и документация
whereis -b python      # только исполняемые файлы
```

---

## 6. Проверка памяти

### 1. Команда `free` — основная

```bash
free -h                 # в удобочитаемом формате
free -m                 # в мегабайтах
free -g                 # в гигабайтах
free -s 5               # обновлять каждые 5 секунд
```

**Пример вывода `free -h`:**
```
              total        used        free      shared  buff/cache   available
Mem:           7.7G        2.1G        3.2G        345M        2.4G        5.0G
Swap:          2.0G        512M        1.5G
```

**Объяснение колонок:**
- **total** — общий объем памяти
- **used** — используется приложениями
- **free** — свободная память
- **shared** — разделяемая память
- **buff/cache** — буферы и кэш ядра
- **available** — доступно для новых приложений

### 2. Интерактивный мониторинг

```bash
top                     # показывает память в заголовке
htop                    # улучшенное отображение
```

### 3. Подробная статистика

```bash
vmstat                  # краткая статистика
vmstat 2 5              # каждые 2 секунды, 5 раз
vmstat -s               # подробная статистика
```

### 4. Информация из ядра

```bash
cat /proc/meminfo       # полная информация о памяти
cat /proc/meminfo | grep -i mem  # только о памяти
```

### 5. Дисковое пространство

```bash
df -h                   # использование дисков
df -i                   # использование inode
du -sh /home/*          # размер директорий
du -h --max-depth=1     # размер на один уровень
```

---

## 7. Проверка сетевых портов

### 1. Команда `ss` — современный стандарт

```bash
ss -tulnp               # все порты с процессами
ss -tln                 # только TCP listening
ss -uln                 # только UDP listening
ss -tlnp | grep :80     # кто слушает порт 80
```

**Флаги:**
- **-t** — TCP соединения
- **-u** — UDP соединения  
- **-l** — только слушающие (LISTEN)
- **-n** — числовые адреса вместо имен
- **-p** — показать процесс/программу

### 2. Команда `netstat` — классический вариант

```bash
netstat -tulnp          # аналог ss -tulnp
netstat -an             # все соединения числами
netstat -rn             # таблица маршрутизации
```

### 3. Детальная информация через `lsof`

```bash
lsof -i                 # все сетевые соединения
lsof -i :22             # кто использует порт 22
lsof -i TCP:80          # TCP соединения на порту 80
lsof -i UDP             # все UDP соединения
lsof -i @192.168.1.1    # соединения с конкретным IP
```

### 4. Сканирование портов `nmap`

```bash
nmap localhost          # сканировать локальные порты
nmap -sV localhost      # с определением версий служб
nmap -p 1-1000 host     # сканировать порты 1-1000
nmap -sS target         # SYN scan (быстрый)
```

*Установка:* `sudo apt install nmap`

### 5. Примеры анализа

```bash
# Найти процесс, слушающий порт 80
ss -tlnp | grep :80
lsof -i :80

# Проверить, открыт ли порт 22 (SSH)
ss -tln | grep :22
telnet localhost 22

# Показать все активные соединения
ss -tupen

# Проверить состояние firewall
sudo iptables -L
sudo ufw status  # для Ubuntu
```

---

## Полезные дополнения

### Комбинации команд:
```bash
# Мониторинг памяти в реальном времени
watch -n 2 free -h

# Найти и удалить временные файлы старше 7 дней
find /tmp -type f -mtime +7 -delete

# Проверить нагрузку на систему
uptime && cat /proc/loadavg

# Показать процессы, потребляющие больше всего памяти
ps aux --sort=-%mem | head -10

# Мониторинг сетевой активности
watch -n 1 'ss -tupen | grep ESTAB | wc -l'
```

### Горячие клавиши в терминале:
- **Ctrl+C** — прервать команду
- **Ctrl+Z** — приостановить команду
- **Ctrl+D** — выйти из оболочки
- **Ctrl+L** — очистить экран
- **Ctrl+R** — поиск в истории команд
- **Tab** — автодополнение
- **↑/↓** — навигация по истории

### Важные директории:
- **/var/log** — лог-файлы
- **/etc** — конфигурационные файлы
- **/proc** — информация о процессах и системе
- **/sys** — интерфейс к ядру
- **/dev** — файлы устройств
- **/tmp** — временные файлы
- **/home** — домашние директории пользователей
